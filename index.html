<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>战技法典 - War Arts Grimoire</title>
    <!-- 引入 html2canvas 库用于截图 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f4e4bc;
            --card-bg: #fffef0;
            --text-color: #2c1810;
            --accent-color: #630e0e; /* 深红 */
            --secondary-color: #3d2b1f; /* 深褐 */
            --border-color: #d4af37; /* 暗金 */
            --meta-bg: rgba(212, 175, 55, 0.15);
            --highlight-dice: #b71c1c;
            --highlight-status: #1a237e;
        }

        body {
            background-color: var(--bg-color);
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23dcb880' fill-opacity='0.2' fill-rule='evenodd'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/svg%3E");
            color: var(--text-color);
            font-family: 'Noto Serif SC', serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        h1 {
            font-family: 'Cinzel', serif;
            text-align: center;
            color: var(--accent-color);
            font-size: 3rem;
            border-bottom: 3px double var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            letter-spacing: 2px;
        }

        h1 span {
            display: block;
            font-size: 1.2rem;
            letter-spacing: 5px;
            color: var(--secondary-color);
            margin-top: 10px;
            font-weight: normal;
        }

        /* Filters */
        .filters {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        .filter-btn {
            background: var(--bg-color);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 10px 20px;
            font-family: 'Noto Serif SC', serif;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 3px 3px 0px rgba(99, 14, 14, 0.2);
            position: relative;
            overflow: hidden;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--accent-color);
            color: #fffef0;
            border-color: var(--secondary-color);
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0px rgba(44, 24, 16, 0.3);
        }

        /* Grid */
        .skills-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 30px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Card */
        .skill-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 25px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08), inset 0 0 40px rgba(212, 175, 55, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .skill-card::before {
            content: "";
            position: absolute;
            top: 4px; left: 4px; right: 4px; bottom: 4px;
            border: 1px solid rgba(99, 14, 14, 0.1);
            pointer-events: none;
        }

        .skill-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: var(--accent-color);
            z-index: 1;
        }

        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 12px;
            margin-bottom: 15px;
            z-index: 2;
            padding-right: 30px; /* Make room for save button */
        }

        .skill-name {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--accent-color);
            margin: 0;
            font-family: 'Noto Serif SC', serif;
        }

        .skill-category {
            font-size: 0.8rem;
            text-transform: uppercase;
            color: #fff;
            font-weight: bold;
            background: var(--secondary-color);
            padding: 4px 8px;
            border-radius: 2px;
            letter-spacing: 1px;
        }

        .skill-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 15px;
            font-size: 0.9rem;
            margin-bottom: 18px;
            background: var(--meta-bg);
            padding: 15px;
            border-radius: 2px;
            border: 1px solid rgba(212, 175, 55, 0.5);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
        }

        .meta-label {
            font-weight: bold;
            font-size: 0.75rem;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.8;
            margin-bottom: 2px;
        }
        
        .meta-value {
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* 来源样式 */
        .meta-source {
            grid-column: 1 / -1;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed rgba(99, 14, 14, 0.3);
            display: flex;
            justify-content: flex-end;
            align-items: center;
            font-size: 0.9rem;
            color: #5c3a21;
        }
        
        .source-label {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-right: 6px;
            text-transform: uppercase;
        }

        .source-name {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.1rem;
        }

        .skill-desc {
            font-size: 1.05rem;
            color: var(--secondary-color);
            flex-grow: 1;
            white-space: pre-wrap;
            text-align: justify;
            line-height: 1.7;
            z-index: 2;
        }

        /* Highlights */
        .hl-dice {
            color: var(--highlight-dice);
            font-weight: bold;
            font-family: 'Cinzel', serif;
        }

        .hl-status {
            color: var(--highlight-status);
            font-weight: bold;
            border-bottom: 1px dotted var(--highlight-status);
        }

        /* Weakness Reveal Box */
        .weakness-reveal {
            margin-top: 20px;
            padding: 15px;
            border: 2px dashed var(--accent-color);
            background-color: rgba(99, 14, 14, 0.05);
            font-size: 0.95rem;
            color: #4a0e0e;
            position: relative;
            z-index: 2;
        }
        
        .weakness-reveal::before {
            content: "✦ 弱点揭示 / 特殊效果 ✦";
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            padding: 0 10px;
            font-size: 0.8rem;
            color: var(--accent-color);
            font-weight: bold;
            border: 1px solid var(--accent-color);
        }

        /* Save Button Style */
        .save-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s, transform 0.2s;
            z-index: 10;
            color: var(--accent-color);
            padding: 5px;
        }

        .save-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        .save-btn:active {
            transform: scale(0.9);
        }

        /* Footer */
        footer {
            margin-top: 60px;
            text-align: center;
            font-size: 0.9rem;
            color: #6d5645;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
            font-family: 'Cinzel', serif;
        }

        @media (max-width: 768px) {
            .skills-container {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 2.2rem; }
        }
    </style>
</head>
<body>

    <h1>战技法典 <span>War Arts Grimoire</span></h1>

    <div class="filters" id="filterContainer">
        <button class="filter-btn active" data-filter="all">全部 (All)</button>
        <button class="filter-btn" data-filter="通用">通用 (General)</button>
        <button class="filter-btn" data-filter="体术">体术 (Brawl)</button>
        <button class="filter-btn" data-filter="身法">身法 (Movement)</button>
        <button class="filter-btn" data-filter="剑">剑术 (Sword)</button>
        <button class="filter-btn" data-filter="矛">矛术 (Spear)</button>
        <button class="filter-btn" data-filter="斧">斧术 (Axe)</button>
        <button class="filter-btn" data-filter="盾">盾牌 (Shield)</button>
        <button class="filter-btn" data-filter="鞭">鞭类 (Whip)</button>
        <button class="filter-btn" data-filter="匕首">匕首 (Dagger)</button>
        <button class="filter-btn" data-filter="投掷">投掷 (Thrown)</button>
        <button class="filter-btn" data-filter="射击">远程/射击 (Ranged)</button>
        <button class="filter-btn" data-filter="特殊">特殊/艺术 (Special)</button>
    </div>

    <div class="skills-container" id="skillsGrid">
        <!-- Content populated by JS -->
    </div>

    <footer>
        <p>May your rolls be high and your failures few. <br> 规则最终解释权归DM所有。</p>
    </footer>

    <script>
        // 战技完整数据 (带来源)
        const skillsData = [
            // --- 传统通用 ---
            {
                name: "击倒", type: "通用", req: "任意格斗30", cap: "自动", prog: "自动", time: "攻击时", equip: "任意近战",
                source: "法外狂徒-张三",
                desc: "该战技受体格影响，战技命中后造成最低伤害(视武器而定，无特效但可以触发流血一类的附加) 。敌人需执行一次“力量”检定，若等级“低于”你的攻击等级则陷入倒地。 若≥攻击等级则陷入1回合减速。 该战技无使用次数限制，但对成功命中过的敌人再度使用此战技会额外+1惩罚骰。(会累加)"
            },
            {
                name: "推撞", type: "通用", req: "斗殴30", cap: "自动", prog: "自动", time: "攻击时", equip: "体术",
                source: "法外狂徒-张三",
                desc: "该战技受体格影响，战技命中后不会造成伤害。而是将敌人击退一格。 对‘友方’使用时可以过‘力量’检定而非斗殴（一样会受到体格差的惩罚影响），击退距离为1-3（普通→极难）。 该战技无使用次数限制"
            },
            {
                name: "紧急移动", type: "通用", req: "无", cap: "无", prog: "无", time: "先攻/回合始", equip: "无",
                source: "法外狂徒-张三",
                desc: "消耗主动动作，执行一次敏捷/闪避(骑马时为骑乘)检定。若成功可执行不会被拦截攻击的移动。 若在先攻开始前检定成功，则直接执行移动。若检定失败，那么主动动作消耗但仍会正常结算该单位的回合(到他回合时无主动动作但仍可以移动) 该战技没有使用次数限制，但有cd，cd为2。"
            },
            {
                name: "睡觉", type: "通用", req: "无", cap: "30(催眠)", prog: "3", time: "主动回合中", equip: "无",
                source: "瞌睡虫 伊娜",
                desc: "主动回合中，可消耗主动动作令自己陷入两回合的睡眠状态。 （睡眠：无法执行任何动作，失能并跳过回合，对睡眠单位施展近战单体攻击时检定额外+1级。受到伤害后会结束该状态）若睡到自然醒恢复d4hp。"
            },
            {
                name: "起床气", type: "通用", req: "无", cap: "40(催眠)", prog: "5", time: "被动", equip: "无",
                source: "瞌睡虫 伊娜",
                desc: "从睡眠中被打醒后可发动，令自身在进入下一个主动回合时，在该主动回合中，额外+2移动力、1寡耐，且对打醒你的单位的攻击检定+1级。"
            },
            {
                name: "回气", type: "通用", req: "无", cap: "无", prog: "3", time: "主动回合中", equip: "无",
                source: "武僧 胡拉姆",
                desc: "消耗主动动作，同时消耗任意移动力， 使自身获得X次+d2护盾。X为消耗移动力/2（向下）"
            },
            {
                name: "聚气", type: "通用", req: "无", cap: "60(任意)", prog: "10", time: "被动", equip: "无",
                source: "武僧 胡拉姆",
                desc: "被动类，每当自身获得护盾值时，额外获得2点护盾。（无法触发该技能的双倍加成）"
            },
            {
                name: "重刃", type: "通用", req: "格斗50", cap: "60(任意)", prog: "5", time: "攻击前", equip: "重量＞5武器",
                source: "哈欠老板 艾布里克",
                desc: "利用武器的重量，在此次攻击命中后额外造成额外DX伤害。 X为武器重量/4（向下）。若武器触发了‘沉重破碎’，改为2DX。"
            },
            {
                name: "沉重破碎", type: "通用", req: "格斗50", cap: "70(任意)", prog: "10", time: "被动", equip: "重量≥10武器",
                source: "哈欠老板 艾布里克",
                desc: "被动类，重型武器获得额外dx无视护甲。x为武器重量/3 向下。"
            },
            {
                name: "佯攻", type: "通用", req: "格斗50", cap: "60(任意)", prog: "5", time: "主动攻击时", equip: "无",
                source: "教官 艾米特",
                desc: "仅主动回合中使用。对一名敌人进行‘佯攻’(正常检定),该动作成功命中时不会造成伤害也不算命中敌方,而是使敌人下一个动作+1惩罚，若为极难，自身下一个动作额外+1奖励。佯攻动作结束后，无论是否命中，自身+1攻击动作。"
            },
            {
                name: "如水", type: "通用", req: "无", cap: "50(任意)", prog: "10", time: "任意时刻", equip: "无",
                source: "爵士 阿斯塔罗斯",
                desc: "任意时刻，可花费1寡耐资源使自己进入某种‘姿态’（未处于寡不敌众时）。"
            },
            {
                name: "五花八门", type: "通用", req: "无", cap: "70(选2个)", prog: "12", time: "被动", equip: "无",
                source: "爵士 阿斯塔罗斯",
                desc: "被动类，在使用近战普通攻击时（包括普通攻击特效型战技）,可附加一个（仅一个）不满足武器需求的‘普通攻击特效型’战技，但仍需满足时机要求。"
            },
             {
                name: "凝神", type: "通用", req: "50射击", cap: "60", prog: "8", time: "先攻结算前", equip: "-",
                source: "长枪使 阿古朵",
                desc: "先攻结算前，可尝试发动该战技。令自身执行“滞后”。 在自己的回合开始前自身若没有执行任何动作、没有被命中时。 该回合开始时进入“瞄准”状态"
            },
            {
                name: "弱点识破", type: "通用", req: "50侦查", cap: "60(侦查)", prog: "5", time: "主动回合中", equip: "-",
                source: "爵士 阿斯塔罗斯",
                desc: "特殊动作,射程20 会受到视线干扰等影响 消耗主动动作/4移动力 对一名目标进行‘侦查’检定。 若成功,则获得一个针对对该目标的“弱点揭示”， 达到‘困难’，则返还消耗。 达到“极难”则改为获得两个针对对该目标的“弱点揭示”。 观察目标处于寡不敌众时，侦查+1奖励骰。 对同样具有“弱点识破”的单位使用该战技，侦查-1级。 该战技没有使用次数限制，但有3回合的冷却时间。且对一个单位使用成功后，再对同样单位使用时，检定额外-1级。",
                weakness: "针对该目标的检定时（攻击/反应），可以消耗1个弱点揭示以获得一个额外奖励骰。也可以消耗1个弱点揭示获得其他战技特效（这种不会获得奖励骰）。"
            },

            // --- 身法 ---
            {
                name: "后空翻", type: "身法", req: "40跳跃/舞蹈", cap: "50", prog: "3", time: "闪避成功时", equip: "-",
                source: "‘莉莉’",
                desc: "闪避成功后可宣言使用该战技。 若自身已陷入寡不敌众则使自己仍可以触发一次闪避移动。 若未寡不敌众,则令自己可以额外闪避移动一次。（相当于双倍闪避移动力，但视为触发两次闪避移动）"
            },
            {
                name: "闪躲翻滚", type: "身法", req: "40闪避", cap: "50", prog: "3", time: "闪避检定前", equip: "-",
                source: "‘莉莉’",
                desc: "在闪避前可宣言使用。 若成功（指达到所需成功等级，而非普通成功），闪避后使自身+1寡耐,且下一轮开始时自己额外+1寡耐。"
            },
            {
                name: "战术步伐", type: "身法", req: "50闪避", cap: "60", prog: "8", time: "闪避成功时", equip: "-",
                source: "‘莉莉’",
                desc: "闪避成功后可宣言使用该战技。 闪避成功（指达到所需成功等级，而非普通成功）后，可使自身下一次攻击动作+1奖励骰。"
            },
            {
                name: "飞身跃入", type: "身法", req: "50跳跃", cap: "60", prog: "5", time: "主动回合中", equip: "-",
                source: "‘莉莉’",
                desc: "消耗2移动力（不消耗其他动作）进行‘跳跃’检定。 若失败，跳跃至‘2距离’中的一格。 若成功，跳跃至2-4距离中的一格，过程中忽略拦截、地表影响，且可直接跃过敌方目标。且使用时，只要角度偏差不超过90°，视为维持‘直线冲锋’不中断。 若跳跃检定达到极难，该主动回合中的下一个近战攻击检定+1DB。"
            },
            {
                name: "本能反应", type: "身法", req: "60闪避", cap: "70", prog: "8", time: "受伤时", equip: "轻盈且非寡",
                source: "‘莉莉’",
                desc: "仅自身处于‘轻盈’时且未处于寡不敌众时可用，受到伤害时。 额外进行‘闪避’检定 ,若成功可令一个针对自己的伤害骰额外-dx。(x为当前轻盈值)"
            },
            {
                name: "游身", type: "身法", req: "60跳跃/舞蹈", cap: "70", prog: "8", time: "先攻开始前", equip: "-",
                source: "‘莉莉’",
                desc: "先攻开始前，可令自身本回合‘穿越’队友时，不消耗移动力。（指代踏入队友的这一格，从队友的格子→空地仍需要移动力），持续一回合。 若已拥有该效果，改为+2移动力。 该战技无使用次数限制，但有3回合冷却。"
            },

            // --- 体术 ---
            {
                name: "乱打一通", type: "体术", req: "30斗殴", cap: "40", prog: "2", time: "主动攻击前", equip: "体术",
                source: "魔法师 克拉拉",
                desc: "攻击特效，将这次攻击变为进行四连击（参考双刀），判定结果-1级。战技结束后自身陷入无法反应且跳过下一回合。"
            },
            {
                name: "回旋踢", type: "体术", req: "40斗殴", cap: "50", prog: "3", time: "攻击前", equip: "体术",
                source: "教官 艾米特",
                desc: "攻击特效，命中后将人击退1格，且一回合中移动力减半。"
            },
            {
                name: "金刚臂", type: "体术", req: "40斗殴", cap: "50", prog: "3", time: "攻击前", equip: "体术",
                source: "教官 艾米特",
                desc: "攻击特效，命中后额外造成D3回合的晕眩。"
            },
            {
                name: "当身猛击", type: "体术", req: "50斗殴", cap: "60", prog: "5", time: "反击前", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "普通攻击特效，仅发动反击前可用，使这次攻击中，令相杀要求从双失败→同级即可。且这次攻击中，自身获得战痕x(x为自身斗殴/10 向下)，会将最多X伤害转化为负伤。"
            },
            {
                name: "飞身踢", type: "体术", req: "40斗殴", cap: "50", prog: "3", time: "主动攻击前", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "攻击特效，令这次攻击命中额外增加db，发动攻击前每直线冲锋3格+1db。"
            },
            {
                name: "过肩摔", type: "体术", req: "50斗殴", cap: "60", prog: "5", time: "反击前", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "可在‘反击’时发动，该战技受到体格影响 且需要敌人可以倒地方可发动。战技命中后可将敌人移动至与自己相邻的一格(也可以不移动),造成自身db+双倍碰撞伤害(碰撞伤害为d3+对方的半db) 并使对方倒地。",
                weakness: "交换双方正反手，检定+1奖励。"
            },
            {
                name: "铁山靠", type: "体术", req: "60斗殴", cap: "70", prog: "8", time: "攻击前", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "该战技受到体格影响，需要敌人可以被击退方可发动。战技命中后，将敌人击退X格。X为2+双方体格差+成功等级（普通→极难， 1/2/3）。此时发生碰撞会造成‘3倍’碰撞伤害。 当目标处于“晕眩”状态时，此战技“无视体格影响”，且发动时额外+1奖励骰。若发生令敌人碰撞造成“4倍”碰撞伤害"
            },
            {
                name: "落饭纲", type: "体术", req: "60斗殴", cap: "70", prog: "8", time: "对倒地攻击前", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "主动回合中使用,仅可对‘倒地’状态的单位使用。 使用该战技时自身斗殴检定额外加一奖励骰 ，且命中后额外+1DB，视为对该格子的1X1‘aoe覆盖攻击’，命中后可追加一次‘跳跃’检定,若跳跃成功这次攻击额外+1db。 命中后造成d8+db伤害"
            },
            {
                name: "肉弹冲击", type: "体术", req: "60斗殴", cap: "70", prog: "8", time: "主动攻击前", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "主动回合中发动，消耗相应的移动力，以全身撞击过去，对路径的敌人近战AOE覆盖攻击。（故不会触发打寡一类的） 但命中目标后会停下。 该战技命中后造成dx+db伤害。 且会同时对自己造成该伤害骰的一半伤害。(向上) 该次斗殴检定可用‘体型’代替 X为当前生命值+护甲值。"
            },
            {
                name: "轰雷", type: "体术", req: "60斗殴", cap: "70", prog: "8", time: "攻击前", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "攻击特效，这次攻击成功“造成伤害”，且检定等级到达极难时，令目标陷入失能。(若为大型改为干扰1回合) 攻击时目标每存在 减速/干扰/晕眩 状态，每拥有一个，所需检定难度-1。(需攻击命中前便存在这些状态)(指无法与金刚臂等直接触发)"
            },
            {
                name: "猛虎下山", type: "体术", req: "70斗殴", cap: "80", prog: "12", time: "主动回合(姿态)", equip: "体术",
                source: "牛面战士 巴鲁巴多",
                desc: "主动回合可花费主动动作进入该姿态 。 姿态效果：移动力+2，获得2层‘猛’，体术普通攻击造成额外X伤害，X为当前‘猛’的层数。 体术攻击获得‘鲁莽挥击’，若本身体术已有鲁莽挥击，则改为进入姿态时额外获得2层猛。 ‘主动回合中’，当体术攻击击败敌人时，获得2移动力，2层‘猛’ 、1个额外的攻击动作，但动作仅可使用体术。（可用体术战技） \n猛：每当自己要陷入失能/跳过回合/干扰/晕眩/减速/倒地时，可消耗一层抵消（每层只能抵消1个）。自身每回合结束时-1猛。每执行一次‘非体术攻击动作’（包括闪避、使用其他道具、其他武器等），-1层猛，猛归0时会脱离姿态。 脱离姿态时失去所有猛。 结束条件：猛→0时，常规结束条件。"
            },
            {
                name: "杀意波动", type: "体术", req: "50斗殴", cap: "60", prog: "5", time: "自身拥有护盾时", equip: "体术",
                source: "武僧 胡拉姆",
                desc: "凝聚全身的‘气’将其化为波动杀伤敌人。 主动回合中发动，‘远程动作’，射程10。发动时消耗自身全部的‘护盾值’ 有两种形式，选择一种发动。 \n1. 单体远程攻击，对一个单位发动（受抵近、远程干扰的影响），进行斗殴检定，命中时对其造成3DX非贯穿物理伤害，X为消耗的护盾值。 \n2. AOE覆盖攻击，对连续3格范围发动（受远程干扰，包裹自己+1级等影响），进行斗殴检定，命中时造成2DX非贯穿型物理伤害，X为消耗的护盾值。"
            },
            {
                name: "无极劲", type: "体术", req: "70斗殴", cap: "80", prog: "12", time: "主动回合(姿态)", equip: "体术",
                source: "武僧 胡拉姆",
                desc: "主动回合可花费主动动作进入该姿态 。 \n姿态效果：自身失去DB加成，每回合额外获得1点寡不敌众耐性，每回合结束时获得相当于剩余寡不敌众耐性的护盾值。 \n主动回合中，以体术普通攻击命中敌人时，可选： \n1. 该次攻击不造成伤害，而是令自身获得DX护盾值，（X为4-当前‘衣装默认护甲值’ ），并令自身寡耐+1。 \n2. 该次攻击造成D3+DX非贯穿型物理伤害，X为当前护盾值的一半（向下）。 \n获得新反应动作‘无极劲’，该动作命中时视为一次战技命中。 \n无极劲：反应动作，每当自身未陷入寡不敌众，且可以反击敌人时可发动。 令自身不反应这次攻击，若对方攻击结算后自身仍有护盾值以及可以反击（未陷入失能 倒地一类的退出状态，或者被击退导致距离不够），则对其‘直接’造成 2DX的非贯穿型物理伤害。X为自身当前护盾值的一半（向下）。"
            },
            {
                name: "如潮", type: "体术", req: "60斗殴", cap: "70", prog: "8", time: "回合开始时", equip: "体术",
                source: "武僧 胡拉姆",
                desc: "主动回合最开始时（未陷入寡不敌众），可令自身陷入“体术造成伤害半减”，持续一回合。 并同时消耗自身全部寡不敌众耐性。每消耗1点寡耐可以获得“1个”仅可使用“体术攻击”的攻击动作。"
            },

            // --- 匕首 ---
            {
                name: "筋键撕裂", type: "匕首", req: "40斗殴", cap: "50", prog: "3", time: "攻击前", equip: "匕首类",
                source: "教官 艾米特",
                desc: "攻击特效,攻击命中且造成伤害后额外+1流血。"
            },
            {
                name: "缝隙扎透", type: "匕首", req: "50斗殴", cap: "60", prog: "5", time: "攻击前", equip: "匕首类",
                source: "伙计 尼西",
                desc: "攻击特效，仅主动回合中可对‘寡不敌众’/‘无法反应’的单位使用 ，以‘单刃’攻击命中额外忽略2/4/8护甲。（普通/困难/极难）"
            },
            {
                name: "攻其不备", type: "匕首", req: "60斗殴", cap: "70", prog: "8", time: "攻击前", equip: "匕首类",
                source: "伙计 尼西",
                desc: "攻击特效，仅主动回合中可对‘寡不敌众’的单位使用 ，以‘单刃’攻击，并使这次攻击失去DB加成，且‘无法反应’。",
                weakness: "令这次攻击暴击难度-1级，失去‘单刃’限制。"
            },
            {
                name: "致命袭击", type: "匕首", req: "60斗殴", cap: "70", prog: "10", time: "被动", equip: "匕首类",
                source: "伙计 尼西",
                desc: "被动类，每当匕首产生暴击时，匕首的攻击面板+2。"
            },
            {
                name: "胡萝卜杀人秘术", type: "匕首", req: "无", cap: "50厨艺", prog: "8", time: "主动回合中", equip: "战斗胡萝卜",
                source: "神秘小店",
                desc: "主动回合可花费主动动作进入该姿态 。 姿态效果： 将战斗🥕视为匕首/剑 每当以战斗🥕击败敌人时，获得一层‘🥕’。每层🥕可以为战斗🥕攻击面板+1，+1额外轻盈值，可叠加，退出姿态时‘🥕’清空。 以战斗🥕发动攻击时，可令自身‘-3轻盈值’（需要至少为3），令这次攻击+额外奖励骰。 每回合限1次，可使用一次食用🥕而不花费动作. 结束条件：对🥕不敬、常规结束条件。"
            },

            // --- 剑 ---
            {
                name: "剑柄打击", type: "剑", req: "40剑", cap: "50", prog: "3", time: "攻击前", equip: "剑类",
                source: "教官 艾米特",
                desc: "战技命中后造成D4+半DB的钝器伤害，施加D3回合的晕眩与干扰。 (使用时不可同一些主动触发的技能共存,比如精细攻击等,但可获得灵动攻击一类的奖励)"
            },
            {
                name: "斩切", type: "剑", req: "40剑", cap: "50", prog: "3", time: "攻击前", equip: "贯穿剑类",
                source: "剑客 阿加莎",
                desc: "攻击特效，具有贯穿属性的剑类攻击命中后对低甲造成额外造成DX伤害，X为轻盈值/4（向上）。"
            },
            {
                name: "兜割", type: "剑", req: "50剑", cap: "60", prog: "5", time: "攻击前", equip: "双手持握剑类",
                source: "剑客 阿加莎",
                desc: "攻击特效,使这次攻击伤害减半，以‘单刃’攻击命中时，若触发‘低甲特效’，则额外结算2次。(比如锋利+4→+12) 该战技无法与‘啄木鸟’一同使用。",
                weakness: "令这次攻击伤害不会减半，且本次攻击“低甲”难度从伤害:护甲≥ 3：1 → ＞ 2:1 即可。"
            },
            {
                name: "半剑术", type: "剑", req: "50剑", cap: "60", prog: "5", time: "攻击前", equip: "双手持握剑类",
                source: "剑客 阿加莎",
                desc: "攻击特效，以‘单刃’攻击命中时额外忽略D2/D4/4护甲。（普通/困难/极难）"
            },
            {
                name: "欺身斩", type: "剑", req: "50剑", cap: "60", prog: "5", time: "闪避成功时", equip: "剑类",
                source: "剑客 阿加莎",
                desc: "在成功闪避后可用。 触发闪避移动时，可以对该敌方(仅攻击你的敌方)进行一次无法反应,伤害减半的主动攻击。(同回击，若武器带有回击则变为闪避后追打2次)"
            },
            {
                name: "快斩", type: "剑", req: "60剑", cap: "70", prog: "8", time: "攻击前", equip: "剑类",
                source: "剑客 阿加莎",
                desc: "攻击特效, 攻击命中后，追加一次无法反应、伤害减半、继承之前攻击的奖惩与db变化的攻击。(同追击 可与追击一同触发 变为一打二追)"
            },
            {
                name: "连击心得", type: "剑", req: "60剑", cap: "无", prog: "10", time: "被动", equip: "剑类",
                source: "黄鼠狼大师",
                desc: "被动类 每回合开始时，每以剑类命中敌人一次，命中的武器攻击面板+1，可叠加，回合结束时重置。仅“剑”检定会触发此额外效果。"
            },
            {
                name: "啄木鸟", type: "剑", req: "60剑", cap: "70", prog: "8", time: "主动攻击前", equip: "重量＜5剑类",
                source: "黄鼠狼大师",
                desc: "攻击特效，以单把武器发动攻击时，可以令武器发动x次连击（参考双刀），造成最低伤害。x为5-武器重量。"
            },
            {
                name: "杀剑", type: "剑", req: "60剑", cap: "70", prog: "8", time: "主动攻击前", equip: "双手持单剑,重＜6",
                source: "黄鼠狼大师",
                desc: "攻击特效,主动回合中，主动攻击前，使这次攻击失去db影响，造成最低伤害，攻击结果+1级",
                weakness: "令这次攻击造成正常伤害而非最低，并且暴击难度-1级。"
            },
            {
                name: "剑锋偏转", type: "剑", req: "40剑", cap: "50", prog: "3", time: "反应时", equip: "双手持剑",
                source: "教官 艾米特",
                desc: "特殊反应动作，仅未陷入寡不敌众与反应近战单体攻击时可用（可以在自身距离外），在反应中进行一次剑检定。 若等级至少为普通成功，本次受到伤害额外骰一次伤害骰并取低值，且结算后自身+1寡不敌众耐性。 若对抗成功 （指检定等级＞敌方的攻击等级，类似反击），使这次攻击无效化并施加攻击方D3回合的干扰。（无法配合盾牌）"
            },

            // --- 矛 ---
            {
                name: "横扫", type: "矛", req: "40矛", cap: "50", prog: "3", time: "主动回合中", equip: "长矛",
                source: "教官 艾米特",
                desc: "主动回合中使用 对连续三格进行横扫aoe(非覆盖) 最终伤害减半。(对aoe不能反击,仅能闪避) 。若武器带有‘横扫’技能，则使扫荡伤害变为标准，而非减半。"
            },
            {
                name: "扫腿", type: "矛", req: "40矛", cap: "50", prog: "3", time: "攻击前", equip: "矛",
                source: "教官 艾米特",
                desc: "攻击特效，攻击命中后，令敌人陷入D3回合减速。"
            },
            {
                name: "反刺", type: "矛", req: "50矛", cap: "60", prog: "5", time: "反击前", equip: "矛",
                source: "长枪使 阿古朵",
                desc: "攻击特效,反击时可用，若命中敌人会额外加上敌方的db加值，但最低为1 最高为2d6。",
                weakness: "交换双方的正反手，且令攻击+1额外奖励骰。"
            },
            {
                name: "精准戳刺", type: "矛", req: "50矛", cap: "60", prog: "5", time: "攻击前", equip: "矛",
                source: "长枪使 阿古朵",
                desc: "攻击特效,该次攻击-1db， +1奖励骰。"
            },
            {
                name: "虎冲", type: "矛", req: "50矛", cap: "60", prog: "5", time: "主动攻击前", equip: "矛",
                source: "长枪使 阿古朵",
                desc: "攻击特效。主动回合中使用， 使这次攻击额外附加dx伤害。(x为发动攻击前累积的直线移动步数 参考冲锋)"
            },
            {
                name: "列阵攻击", type: "矛", req: "50矛", cap: "60", prog: "10", time: "被动", equip: "矛",
                source: "长枪使 阿古朵",
                desc: "被动类 令矛类武器的攻击面板+DX，X为自身相邻友军数，。仅“矛”检定会触发此额外效果。"
            },

            // --- 斧 ---
            {
                name: "重击", type: "斧", req: "40斧", cap: "50", prog: "3", time: "主动攻击前", equip: "斧",
                source: "教官 艾米特",
                desc: "攻击特效(可触发平a其他技能特效等),攻击前进行一次‘力量’检定 成功可使该次攻击+1级db 若力量为极难则+2级db"
            },
            {
                name: "怒", type: "斧", req: "50斧", cap: "60", prog: "5", time: "受伤后", equip: "斧",
                source: "瞌睡虫 伊娜",
                desc: "当你受到伤害后，可令自身下次以斧的攻击+1奖励。若发动时hp≤最大hp一半，额外+1db"
            },
            {
                name: "血偿", type: "斧", req: "50斧", cap: "60", prog: "5", time: "攻击前", equip: "斧",
                source: "瞌睡虫 伊娜",
                desc: "攻击特效，攻击命中后，另一个伤害骰额外+DX，X为自身已损失生命值。"
            },
            {
                name: "大动作", type: "斧", req: "60斧", cap: "70", prog: "8", time: "先攻开始前", equip: "斧",
                source: "瞌睡虫 伊娜",
                desc: "先攻开始前，可宣言发动次战技。令自身直接执行‘滞后’，并使自己‘一把斧的武器重量翻倍’。（同时会受到增重后的负重效果影响） 在自己的回合开始前自身若执行其他动作（反击/闪避等），则重量恢复且无其他效果。 在自己的回合开始前自身若没有执行任何动作（反击/闪避等）。 回合开始时，使自身忽略超重惩罚，此武器下一次攻击命中后额外+DX伤害，攻击结算后重量增加的效果结束。X为当前武器重量。"
            },

            // --- 盾 ---
            {
                name: "盾牌猛击", type: "盾", req: "30斗殴", cap: "40", prog: "3", time: "攻击前", equip: "盾",
                source: "教官 艾米特",
                desc: "攻击特效,以盾牌猛击敌人。 造成额外dx钝器伤害。(x为盾牌重量)"
            },
            {
                name: "急援", type: "盾", req: "40闪避", cap: "50", prog: "5", time: "盾牌激活后", equip: "盾",
                source: "教官 艾米特",
                desc: "盾牌激活时的任意时刻。可令自身额外获得一次‘援护’"
            },
            {
                name: "全防守", type: "盾", req: "无", cap: "50(斗殴)", prog: "5", time: "盾牌激活中，反应时", equip: "重量＞3盾",
                source: "教官 艾米特",
                desc: "新反应动作，在盾牌激活中可用，令自身面对这次攻击时，自身护甲视为翻倍。结算后自身+1寡耐。（该反应动作本身也是正常-1寡的。）"
            },
            {
                name: "组合打击", type: "盾", req: "40斗殴", cap: "50", prog: "8", time: "主动回合中", equip: "重量＜6盾",
                source: "教官 艾米特",
                desc: "主动回合中使用,以盾牌发动一次攻击后。若该次攻击命中，可消耗1寡耐，获得一个可以使用仅可以另一手武器攻击的攻击动作。 若命中的盾牌重量＜4，额外获得的攻击动作+1奖励骰。"
            },
            {
                name: "盾反", type: "盾", req: "50斗殴", cap: "60", prog: "8", time: "反击前", equip: "盾",
                source: "教官 艾米特",
                desc: "攻击特效，以盾牌反击时，若命中敌人额外增加X伤害且施加D2回合的干扰与晕眩。X为盾牌提供的护甲。",
                weakness: "交换双方的正反手，且令攻击+1额外奖励骰。"
            },
            {
                name: "盾牌突击", type: "盾", req: "50斗殴", cap: "60", prog: "8", time: "主动回合中", equip: "盾",
                source: "教官 艾米特",
                desc: "消耗主动动作与消耗相应的移动力，举盾并撞击过去，若未激活盾牌，发动此战技时会额外激活盾牌。 对路径的敌人近战AOE覆盖攻击。但命中一个目标后会停下。对目标造成盾牌面板+自身DB+DX伤害。 X为当前盾牌提供的护甲。"
            },
            {
                name: "岿然不动", type: "盾", req: "50斗殴", cap: "60", prog: "12", time: "盾牌激活时", equip: "盾",
                source: "教官 艾米特",
                desc: "激活盾牌时，可使自身从盾牌中额外获得X护甲，无法被暴击，持续一回合。（X为自身当前负重/4）"
            },

            // --- 鞭 ---
            {
                name: "缠绕", type: "鞭", req: "30鞭", cap: "自动", prog: "自动", time: "主动回合时", equip: "鞭",
                source: "剧院主人 蕾米莉亚",
                desc: "该战技受体格影响，战技命中后鞭子会缠绕在敌人上,无法继续使用该鞭子,且需要一手维持，仅能使用另一手的单手武器。 该战技无使用次数限制，但敌人挣脱后，对该敌人再度使用此战技会额外+1惩罚骰。 \n缠绕状态：该敌人获得一个额外行动惩罚,且寡耐-1,无法移动至你鞭子的攻击范围外,直到花费主动动作挣脱。（挣脱：可进行力量/格斗与 鞭/力量 对抗挣脱，该挣脱不会受到缠绕惩罚影响）",
                weakness: "令这次战技“不受”体格影响，并且命中后下一个追加缠绕战技检定+1级。"
            },
            {
                name: "秋千", type: "鞭", req: "50鞭", cap: "60", prog: "5", time: "缠绕命中时", equip: "鞭",
                source: "剧院主人 蕾米莉亚",
                desc: "当缠绕命中后，可执行一次以 鞭/力量 与敌人的 力量对抗。若对抗成功，可将该敌人拉拽至攻击范围内的一格，若格子上有单位/阻碍物，则发生碰撞。"
            },
            {
                name: "阻碍之蛇", type: "鞭", req: "50鞭", cap: "60", prog: "5", time: "缠绕命中时", equip: "鞭",
                source: "剧院主人 蕾米莉亚",
                desc: "当缠绕命中后，可执行一次以 鞭/力量 与敌人的 力量对抗。若对抗成功，会额外令敌人陷入倒地状态。"
            },
            {
                name: "钓野伏", type: "鞭", req: "50鞭", cap: "60", prog: "5", time: "攻击命中后", equip: "鞭",
                source: "剧院主人 蕾米莉亚",
                desc: "主动回合中，以鞭子主动攻击命中后。可消耗1寡耐，发动一次对同样单位的‘缠绕’"
            },
            {
                name: "狩猎行动", type: "鞭", req: "60鞭", cap: "70", prog: "8", time: "缠绕命中时", equip: "鞭",
                source: "剧院主人 蕾米莉亚",
                desc: "当缠绕命中后，可执行一次以 鞭/力量 与敌人的 力量对抗。若对抗成功，可将敌人拉拽至自身相邻的一格，并获得一个仅能使用另一手的单手武器攻击该目标的攻击动作。"
            },
            {
                name: "钓瓶月", type: "鞭", req: "60鞭", cap: "70", prog: "8", time: "主动攻击前", equip: "鞭",
                source: "剧院主人 蕾米莉亚",
                desc: "攻击特效，可令这次单次攻击变为二连击。"
            },
            {
                name: "压制鞭打", type: "鞭", req: "50鞭", cap: "70", prog: "10", time: "被动", equip: "鞭",
                source: "剧院主人 蕾米莉亚",
                desc: "被动类，以鞭子攻击陷入不良状况的单位时，干扰/晕眩/减速/寡不敌众/无法反应，每拥有一种，鞭的攻击面板+1."
            },
            {
                name: "胡萝卜与鞭子", type: "鞭", req: "50鞭", cap: "60", prog: "5", time: "攻击命中后", equip: "鞭",
                source: "神秘小店",
                desc: "主动回合中，以鞭子主动攻击命中一名单位后。可额外执行一次‘驯兽’检定，若成功，根据等级普通→极难令对方在1/2/3回合中，每回合获得一个自选奖励骰。（但该奖励最大存在1.无法累积），可额外消耗1个食用胡萝卜，令这次驯兽奖励+1奖励骰且令对方视为‘吃下了胡萝卜’"
            },

            // --- 投掷 ---
            {
                name: "阴招", type: "投掷", req: "40投掷/妙手", cap: "50", prog: "3", time: "远程攻击时", equip: "粉末类",
                source: "法外狂徒-张三",
                desc: "主动回合中，可消耗1寡耐进行一次投掷，该次投掷仅可用粉末类物品（石灰粉，其他粉尘），且射程上限调整为3。 该次投掷检定可用‘妙手’代替。 没有‘阴招’战技的单位反应该战技时额外获得一个惩罚骰。"
            },
            {
                name: "刀锋之舞", type: "投掷", req: "50投掷", cap: "60", prog: "5", time: "远程攻击时", equip: "投匕/飞刀",
                source: "伙计 尼西",
                desc: "主动回合中可用，可消耗1寡耐进行一次投掷，该次投掷仅可用投匕/飞刀。"
            },
            {
                name: "猎头", type: "投掷", req: "50投掷", cap: "60", prog: "5", time: "远程攻击时", equip: "投斧",
                source: "森林猎手 格里勒",
                desc: "攻击前，可以使这次攻击暴击难度降低一级。",
                weakness: "令这个攻击+1奖励骰，且暴击时额外造成一次武器面板伤害。"
            },
            {
                name: "贯穿之矛", type: "投掷", req: "60投掷", cap: "70", prog: "8", time: "远程攻击前", equip: "投矛",
                source: "森林猎手 格里勒",
                desc: "攻击特效，令这次攻击命中时造成额外增加DX 伤害， x为你与敌人的距离。",
                weakness: "令这次攻击无法反应。"
            },
            {
                name: "狩猎心得", type: "投掷", req: "无", cap: "70", prog: "10", time: "被动", equip: "投掷类",
                source: "森林猎手 格里勒",
                desc: "被动类，使用投掷类物品（包括投掷武器，投掷消耗物等），远程移动力上限额外+1"
            },
            {
                name: "天狗抄", type: "投掷", req: "50投掷/跳跃/闪避", cap: "60", prog: "8", time: "闪避移动时", equip: "AOE投掷物",
                source: "‘莉莉’",
                desc: "每当自身触发闪避移动时，在闪避移动完毕后。可发动一次AOE投掷攻击，这次攻击需要‘囊括’自身闪避移动前所在的位置，并且视为触发AOE覆盖自己的特效（既+1级）"
            },
            {
                name: "完美回旋", type: "投掷", req: "50投掷", cap: "70", prog: "8", time: "被甜甜圈弹射时", equip: "甜甜圈",
                source: "神秘小店",
                desc: "每当甜甜圈要命中自己时可发动。可消耗1寡耐， 接过甜甜圈并再度投掷给一个目标，令等级在之前基础上额外+1级。（比如原本普通级→困难级） 再度投掷会重置可弹射次数，但“继承”先前的弹射威力倍率。"
            },

            // --- 射击/远程 ---
            {
                name: "射击步法", type: "射击", req: "40弓", cap: "50", prog: "3", time: "主动回合中", equip: "重量＜4短弓",
                source: "森林猎手 格里勒",
                desc: "使本回合中以短弓射击可以忽略远程锁2限制。"
            },
            {
                name: "迅捷射法", type: "射击", req: "50弓", cap: "60", prog: "5", time: "先攻开始前", equip: "重量＜4短弓",
                source: "森林猎手 格里勒",
                desc: "令1回合中短弓射击时，攻击面板额外+x，x为轻盈值/4 向上"
            },
            {
                name: "连发射术", type: "射击", req: "60弓", cap: "70", prog: "8", time: "先攻开始前", equip: "重量＜4短弓",
                source: "森林猎手 格里勒",
                desc: "令自身一回合中，以短弓射击时，可以这次射击最大连射数额外+2."
            },
            {
                name: "速射法", type: "射击", req: "60弓", cap: "70", prog: "10", time: "被动", equip: "重量＜4短弓",
                source: "森林猎手 格里勒",
                desc: "被动类，自身HP为最大值时，令短弓最大连射数额外+1."
            },
            {
                name: "劲弓", type: "射击", req: "40弓", cap: "50", prog: "3", time: "距离3内无敌", equip: "重量＞4长弓",
                source: "长枪使 阿古朵",
                desc: "攻击特效，若弓的DB为‘半DB’则改为‘全DB’，若原本是全DB则可令力量检定+1奖励骰。 攻击前可以执行力量检定，普通成功为这次射击+1db 极难+2db。"
            },
            {
                name: "散射", type: "射击", req: "50弓", cap: "60", prog: "5", time: "距离5内无敌", equip: "重量＞4长弓",
                source: "长枪使 阿古朵",
                desc: "令射击额外获得连射惩罚骰，发动一次连续三格的aoe射击。(非覆盖 非攻击特效 但可触发流血，势沉，锋利，破甲等。（致命不行）)"
            },
            {
                name: "抵近火枪", type: "射击", req: "50步枪/斗殴", cap: "60", prog: "5", time: "枪托命中后", equip: "步枪",
                source: "火枪手 阿尔巴",
                desc: "主动回合中，可以以步枪枪托攻击命中敌人时，可令这次攻击造成最低伤害与+D2干扰。并对其发动一次‘抵近射击’，无视近战干扰，远程移动限制，以及无法被反应。"
            },
            {
                name: "双发", type: "射击", req: "50手枪", cap: "60", prog: "5", time: "射击时", equip: "双持手枪",
                source: "火枪手 拉菲",
                desc: "以手枪射击时,可额外消耗1寡耐, 射击完毕后获得一个 仅可以以另一把手枪射击的攻击动作,另一把手枪的射击动作 带1额外惩罚，但可以选择其他目标。"
            },

            // --- 特殊/其他 ---
            {
                name: "释放心中猛兽", type: "特殊", req: "40绘画", cap: "70", prog: "8", time: "主动回合中", equip: "绘画工具",
                source: "设计师 ‘烤肉’",
                desc: "特殊动作，视为远程动作（会被干扰）。主动回合中，可消耗主动动作进行绘画检定。在画板上作画。根据难度可以消耗最多 D6/D6+6/D8+8/D10+10（失败→极难）的MP去绘制属于自己的‘化身’（不能是形态型化身）。当MP投入抵达化身所需MP后，可以召唤化身至3距离中的空地上。并且受你控制。面板数据与持续时间、天赋情况与你自己变的一样。 该战技没有使用次数限制，但有CD，CD为3。（完全绘画出一个后，要等3回合才能绘制下一个）"
            },
            {
                name: "悲静之音", type: "特殊", req: "50音乐/歌唱", cap: "70", prog: "8", time: "主动回合中", equip: "-",
                source: "‘三弦’",
                desc: "特殊动作，视为远程动作。射程3。主动回合中，消耗主动动作 进行一次‘音乐类’检定。根据等级（普通/困难/极难） 可对1个友方单位（可选自己），移除对方1/2/3个状态（比如失能、晕眩、干扰、流血、中毒等，部分普通诅咒也可以移除。），且令对方一回合中不会再陷入这些状态。 该战技没有使用次数限制，但有CD，CD为3。"
            },
            {
                name: "无法遗忘的心声", type: "特殊", req: "60音乐/歌唱", cap: "80", prog: "12", time: "主动回合中", equip: "-",
                source: "法外狂徒-张三",
                desc: "远程动作，特殊动作，可对距离为1的单位使用。 主动回合中，消耗主动动作对其进行一次‘音乐类’检定。 至少为普通成功后。在你的回合结束后会紧接着一个对方的‘额外回合’（拥有独立主动动作与移动力），根据你的检定等级，该额外回合对方获得额外1/2/3移动力（普通→极难），无额外寡耐。 该战技没有使用次数限制，但有CD，CD为‘5’。"
            },
            {
                name: "骑马撞击", type: "特殊", req: "40骑乘", cap: "50", prog: "3", time: "主动回合中", equip: "骑乘",
                source: "教官 艾米特",
                desc: "主动回合中，可以花费主动动作/6移动力，令马匹撞击敌人(近战判定，距离1，攻击检定为骑乘) 命中后造成d6+马匹冲击力伤害(属性为非贯穿) ，击退一格且令敌人进行一次力量检定，若等级低于你的骑乘攻击检定，则倒地。"
            }
        ];

        const container = document.getElementById('skillsGrid');
        const filters = document.querySelectorAll('.filter-btn');

        // 高亮关键词处理
        function formatDescription(text) {
            let html = text;
            // 高亮骰子 (Dx, dX, XdX)
            html = html.replace(/(\d*[dD]\d+)/g, '<span class="hl-dice">$1</span>');
            // 高亮状态词
            const statuses = ['晕眩', '倒地', '失能', '流血', '干扰', '减速', '寡不敌众', '无法反应', '睡眠', '超重'];
            statuses.forEach(status => {
                const regex = new RegExp(status, 'g');
                html = html.replace(regex, `<span class="hl-status">${status}</span>`);
            });
            return html;
        }

        // 保存卡片图片
        function captureCard(button) {
            // 找到按钮所在的卡片
            const card = button.closest('.skill-card');
            const originalText = button.innerHTML;
            button.innerHTML = '⏳'; // 显示加载状态

            html2canvas(card, {
                backgroundColor: null,
                scale: 3, // 提高清晰度
                useCORS: true, // 允许跨域（字体等）
                ignoreElements: (element) => element.classList.contains('save-btn') // 截图时忽略按钮
            }).then(canvas => {
                // 创建下载链接
                const link = document.createElement('a');
                const skillName = card.querySelector('.skill-name').textContent;
                link.download = `${skillName}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                button.innerHTML = originalText; // 恢复按钮
            }).catch(err => {
                console.error('Capture failed:', err);
                button.innerHTML = '❌';
                setTimeout(() => button.innerHTML = originalText, 2000);
            });
        }

        function renderSkills(filterType) {
            container.innerHTML = '';
            
            const filteredSkills = filterType === 'all' 
                ? skillsData 
                : skillsData.filter(skill => {
                    // 特殊映射处理
                    if (filterType === '特殊' && (skill.name.includes('胡萝卜') || skill.name.includes('骑马'))) return true;
                    return skill.type === filterType;
                });

            if (filteredSkills.length === 0) {
                container.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:#888; padding:50px;">暂无相关记载</div>';
                return;
            }

            filteredSkills.forEach(skill => {
                const card = document.createElement('div');
                card.className = 'skill-card';
                
                let weaknessHtml = '';
                if (skill.weakness) {
                    weaknessHtml = `<div class="weakness-reveal">${formatDescription(skill.weakness)}</div>`;
                }

                card.innerHTML = `
                    <button class="save-btn" onclick="captureCard(this)" title="保存为图片">💾</button>
                    <div class="skill-header">
                        <h3 class="skill-name">${skill.name}</h3>
                        <span class="skill-category">${skill.type}</span>
                    </div>
                    <div class="skill-meta">
                        <div class="meta-item">
                            <span class="meta-label">需求 Req</span>
                            <span class="meta-value">${skill.req}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">时机 Timing</span>
                            <span class="meta-value">${skill.time}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">上限 Cap</span>
                            <span class="meta-value">${skill.cap}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">进度 Prog</span>
                            <span class="meta-value">${skill.prog}</span>
                        </div>
                        <div class="meta-item" style="grid-column: 1 / -1;">
                            <span class="meta-label">装备 Equip</span>
                            <span class="meta-value">${skill.equip}</span>
                        </div>
                        <div class="meta-source">
                            <span class="source-label">From:</span>
                            <span class="source-name">${skill.source}</span>
                        </div>
                    </div>
                    <div class="skill-desc">${formatDescription(skill.desc)}</div>
                    ${weaknessHtml}
                `;
                container.appendChild(card);
            });
        }

        // 绑定筛选
        filters.forEach(btn => {
            btn.addEventListener('click', () => {
                filters.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                renderSkills(btn.dataset.filter);
            });
        });

        // 初始化
        renderSkills('all');

    </script>
</body>
</html>
